% lab2.txt data structure:
% time	V(n001)	V(n002)	I(R1)

\begin{figure}[h]
	\centering
	\begin{tikzpicture}[scale=0.88]

		% Voltage axis
		\begin{axis}[
				width=17cm, height=12cm,
				xlabel={Time [ms]},    % X-axis label
				ylabel={Voltage [V]},    % Y-axis label
				grid=major,           % Enable grid
				legend style={at={(0.857,0.95)}, anchor=north west}, % Legend position
				thick,                % Line thickness
				xmin=0, xmax=120,    % X-axis range
				ymin=-2, ymax=2,      % Y-axis range
				axis y line=right,
				axis x line=bottom,
				label style={font=\small},
				tick label style={font=\small},
				major tick length=0.2cm,
				ytick style={thick, black},
				xtick style={thick, black},
				ytick={-1.6, -1.2, -0.8, -0.4, 0, 0.4, 0.8, 1.2, 1.6},
				extra y ticks={-2, 2},
				extra y tick style={tick style={opacity=0}},
				x unit=0.001,
			]

			% Plot V(n001)
			\addplot[
				color=red,
				thick,
			] table [x expr=\thisrowno{0}*1000, y index=1, col sep=space] {./data/lab2.txt};
			\addlegendentry{$E$}

			% Plot V(n002)
			\addplot[
				color=green,
				thick,
				% nodes near coords,
				% mark=*,
				% every node near coord/.append style={font=\tiny, black}
			] table [x expr=\thisrowno{0}*1000, y index=2, col sep=space] {./data/lab2.txt};
			\addlegendentry{$U_c$}

			\draw[dashed,grey,very thin] (axis cs:120,1.972884) -- (axis cs:60.1,1.972884);
			\addplot[color=black, only marks, mark=*, mark size=1.5pt] coordinates {(60.1,1.972884)};
			\node[anchor=west] at (axis cs:60.1,1.872884) {\scriptsize $U_c(\infty) = 1.973 \, V$};

			\draw[dashed,grey,very thin] (axis cs:120,-1.973) -- (axis cs:120, -1.973)
			\addplot[color=black, only marks, mark=*, mark size=1.5pt] coordinates {(120, -1.973)};
			\node[anchor=east] at (axis cs:121,-1.82) {\scriptsize $ -1.973 \, V = U_c(0+)$};

		\end{axis}

		% Current axis
		\begin{axis}[
				width=17cm, height=12cm,
				xmin=0, xmax=120,    % X-axis range (same as for Voltage)
				ymin=-100, ymax=100,  % Y-axis range for Current
				axis y line=left,         % Place this axis on the right for Current
				axis x line=none,
				thick,
				ylabel={Current [mA]}, % Y-axis label for Current
				label style={font=\small},
				tick label style={font=\small},
				major tick length=0.2cm,
				ytick style={thick, black},
				ytick={-80, -60, -40, -20, 0, 20, 40, 60, 80},  % Y-axis ticks without ymax
				extra y ticks={-100, 100}, % Add min and max ticks for right axis
				extra y tick style={tick style={opacity=0}}, % Hide tick marks for these
				legend style={at={(0.955,0.82)}, anchor=north east}, % Legend position for Current
			]
			% Plot I(R1)
			\addplot[
				color=blue,
				thick,
				% mark=ball,
				% mark size=1.5pt
			] table [x expr=\thisrowno{0}*1000, y expr=\thisrowno{3}*1000, col sep=space] {./data/lab2.txt};
			\addlegendentry{$I$}

			\addplot[color=black, only marks, mark=*, mark size=1pt] coordinates {(0.13, 100)};
			\node[anchor=west] at (axis cs:0,95.5) {\scriptsize $I(0+) = 99.996 \, mA$};

			\addplot[color=black, only marks, mark=*, mark size=1.5pt] coordinates {(60, 0.674)};
			\node[anchor=east] at (axis cs:61,-4.5) {\scriptsize $0.674 \, mA = I(\infty)$};

			\addplot[color=black, only marks, mark=*, mark size=1.7pt] coordinates {(8.4, 50)};
			\node[anchor=west] at (axis cs:8.4,50) {\scriptsize $I(t_{0.5}) = 50\, \text{mA}$};

			\addplot[color=black, only marks, mark=*, mark size=1.5pt] coordinates {(8.4, -100)};
			\node[anchor=east] at (axis cs:9,-95) {\small $t_{0.5}$};

			\draw[dashed, grey, very thin] (axis cs:8.4, 50) -- (axis cs:8.4, -102);

		\end{axis}
	\end{tikzpicture}
\end{figure}
